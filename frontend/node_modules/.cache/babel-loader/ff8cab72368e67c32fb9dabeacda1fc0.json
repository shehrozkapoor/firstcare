{"ast":null,"code":"import \"core-js/modules/es.error.cause.js\";\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  }, _typeof(obj);\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}\n\nfunction _get() {\n  if (typeof Reflect !== \"undefined\" && Reflect.get) {\n    _get = Reflect.get;\n  } else {\n    _get = function _get(target, property, receiver) {\n      var base = _superPropBase(target, property);\n\n      if (!base) return;\n      var desc = Object.getOwnPropertyDescriptor(base, property);\n\n      if (desc.get) {\n        return desc.get.call(arguments.length < 3 ? target : receiver);\n      }\n\n      return desc.value;\n    };\n  }\n\n  return _get.apply(this, arguments);\n}\n\nfunction _superPropBase(object, property) {\n  while (!Object.prototype.hasOwnProperty.call(object, property)) {\n    object = _getPrototypeOf(object);\n    if (object === null) break;\n  }\n\n  return object;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  Object.defineProperty(subClass, \"prototype\", {\n    writable: false\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  } else if (call !== void 0) {\n    throw new TypeError(\"Derived constructors may only return object or undefined\");\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nimport \"core-js/modules/es.array.iterator.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/es.weak-map.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/es.array.index-of.js\";\nimport \"core-js/modules/es.array.sort.js\";\nimport \"core-js/modules/es.array.find.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.string.replace.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.object.set-prototype-of.js\";\nimport \"core-js/modules/es.object.get-prototype-of.js\";\nimport \"core-js/modules/es.reflect.construct.js\";\nimport \"core-js/modules/es.reflect.get.js\";\nimport \"core-js/modules/es.object.get-own-property-descriptor.js\";\nimport \"core-js/modules/es.symbol.js\";\nimport \"core-js/modules/es.symbol.description.js\";\nimport \"core-js/modules/es.symbol.iterator.js\";\nimport { HandsontableEditor } from \"../handsontableEditor/index.mjs\";\nimport { arrayMap, pivot } from \"../../helpers/array.mjs\";\nimport { addClass, getCaretPosition, getScrollbarWidth, getSelectionEndPosition, getTrimmingContainer, offset, outerHeight, outerWidth, setCaretPosition } from \"../../helpers/dom/element.mjs\";\nimport { isDefined, stringify } from \"../../helpers/mixed.mjs\";\nimport { stripTags } from \"../../helpers/string.mjs\";\nimport { KEY_CODES, isPrintableChar } from \"../../helpers/unicode.mjs\";\nimport { textRenderer } from \"../../renderers/textRenderer/index.mjs\";\nvar privatePool = new WeakMap();\nexport var EDITOR_TYPE = 'autocomplete';\n/**\n * @private\n * @class AutocompleteEditor\n */\n\nexport var AutocompleteEditor = /*#__PURE__*/function (_HandsontableEditor) {\n  _inherits(AutocompleteEditor, _HandsontableEditor);\n\n  var _super = _createSuper(AutocompleteEditor);\n\n  function AutocompleteEditor(instance) {\n    var _this;\n\n    _classCallCheck(this, AutocompleteEditor);\n\n    _this = _super.call(this, instance);\n    /**\n     * Query string to turn available values over.\n     *\n     * @type {string}\n     */\n\n    _defineProperty(_assertThisInitialized(_this), \"sortByRelevance\", function (value, choices, caseSensitive) {\n      var choicesRelevance = [];\n      var result = [];\n      var valueLength = value.length;\n      var choicesCount = choices.length;\n      var charsLeft;\n      var currentItem;\n      var i;\n      var valueIndex;\n\n      if (valueLength === 0) {\n        for (i = 0; i < choicesCount; i++) {\n          result.push(i);\n        }\n\n        return result;\n      }\n\n      for (i = 0; i < choicesCount; i++) {\n        currentItem = stripTags(stringify(choices[i]));\n\n        if (caseSensitive) {\n          valueIndex = currentItem.indexOf(value);\n        } else {\n          var locale = this.cellProperties.locale;\n          valueIndex = currentItem.toLocaleLowerCase(locale).indexOf(value.toLocaleLowerCase(locale));\n        }\n\n        if (valueIndex !== -1) {\n          charsLeft = currentItem.length - valueIndex - valueLength;\n          choicesRelevance.push({\n            baseIndex: i,\n            index: valueIndex,\n            charsLeft: charsLeft,\n            value: currentItem\n          });\n        }\n      }\n\n      choicesRelevance.sort(function (a, b) {\n        if (b.index === -1) {\n          return -1;\n        }\n\n        if (a.index === -1) {\n          return 1;\n        }\n\n        if (a.index < b.index) {\n          return -1;\n        } else if (b.index < a.index) {\n          return 1;\n        } else if (a.index === b.index) {\n          if (a.charsLeft < b.charsLeft) {\n            return -1;\n          } else if (a.charsLeft > b.charsLeft) {\n            return 1;\n          }\n        }\n\n        return 0;\n      });\n\n      for (i = 0, choicesCount = choicesRelevance.length; i < choicesCount; i++) {\n        result.push(choicesRelevance[i].baseIndex);\n      }\n\n      return result;\n    });\n\n    _this.query = null;\n    /**\n     * Contains stripped choices.\n     *\n     * @type {string[]}\n     */\n\n    _this.strippedChoices = [];\n    /**\n     * Contains raw choices.\n     *\n     * @type {Array}\n     */\n\n    _this.rawChoices = [];\n    privatePool.set(_assertThisInitialized(_this), {\n      skipOne: false,\n      isMacOS: _this.hot.rootWindow.navigator.platform.indexOf('Mac') > -1\n    });\n    return _this;\n  }\n  /**\n   * Gets current value from editable element.\n   *\n   * @returns {string}\n   */\n\n\n  _createClass(AutocompleteEditor, [{\n    key: \"getValue\",\n    value: function getValue() {\n      var _this2 = this;\n\n      var selectedValue = this.rawChoices.find(function (value) {\n        var strippedValue = _this2.stripValueIfNeeded(value);\n\n        return strippedValue === _this2.TEXTAREA.value;\n      });\n\n      if (isDefined(selectedValue)) {\n        return selectedValue;\n      }\n\n      return this.TEXTAREA.value;\n    }\n    /**\n     * Creates an editor's elements and adds necessary CSS classnames.\n     */\n\n  }, {\n    key: \"createElements\",\n    value: function createElements() {\n      _get(_getPrototypeOf(AutocompleteEditor.prototype), \"createElements\", this).call(this);\n\n      addClass(this.htContainer, 'autocompleteEditor');\n      addClass(this.htContainer, this.hot.rootWindow.navigator.platform.indexOf('Mac') === -1 ? '' : 'htMacScroll');\n    }\n    /**\n     * Opens the editor and adjust its size and internal Handsontable's instance.\n     */\n\n  }, {\n    key: \"open\",\n    value: function open() {\n      var _this3 = this;\n\n      var priv = privatePool.get(this);\n\n      _get(_getPrototypeOf(AutocompleteEditor.prototype), \"open\", this).call(this);\n\n      var choicesListHot = this.htEditor.getInstance();\n      var trimDropdown = this.cellProperties.trimDropdown === void 0 ? true : this.cellProperties.trimDropdown;\n      this.showEditableElement();\n      this.focus();\n      var scrollbarWidth = getScrollbarWidth();\n\n      if (scrollbarWidth === 0 && priv.isMacOS) {\n        scrollbarWidth += 15; // default scroll bar width if scroll bars are visible only when scrolling\n      }\n\n      choicesListHot.updateSettings({\n        colWidths: trimDropdown ? [outerWidth(this.TEXTAREA) - 2] : void 0,\n        width: trimDropdown ? outerWidth(this.TEXTAREA) + scrollbarWidth : void 0,\n        renderer: function renderer(instance, TD, row, col, prop, value, cellProperties) {\n          textRenderer(instance, TD, row, col, prop, value, cellProperties);\n          var _this3$cellProperties = _this3.cellProperties,\n              filteringCaseSensitive = _this3$cellProperties.filteringCaseSensitive,\n              allowHtml = _this3$cellProperties.allowHtml,\n              locale = _this3$cellProperties.locale;\n          var query = _this3.query;\n          var cellValue = stringify(value);\n          var indexOfMatch;\n          var match;\n\n          if (cellValue && !allowHtml) {\n            indexOfMatch = filteringCaseSensitive === true ? cellValue.indexOf(query) : cellValue.toLocaleLowerCase(locale).indexOf(query.toLocaleLowerCase(locale));\n\n            if (indexOfMatch !== -1) {\n              match = cellValue.substr(indexOfMatch, query.length);\n              cellValue = cellValue.replace(match, \"<strong>\".concat(match, \"</strong>\"));\n            }\n          }\n\n          TD.innerHTML = cellValue;\n        },\n        autoColumnSize: true\n      });\n\n      if (priv.skipOne) {\n        priv.skipOne = false;\n      }\n\n      this.hot._registerTimeout(function () {\n        _this3.queryChoices(_this3.TEXTAREA.value);\n      });\n    }\n    /**\n     * Closes the editor.\n     */\n\n  }, {\n    key: \"close\",\n    value: function close() {\n      this.removeHooksByKey('beforeKeyDown');\n\n      _get(_getPrototypeOf(AutocompleteEditor.prototype), \"close\", this).call(this);\n    }\n    /**\n     * Verifies result of validation or closes editor if user's cancelled changes.\n     *\n     * @param {boolean|undefined} result If `false` and the cell using allowInvalid option,\n     *                                   then an editor won't be closed until validation is passed.\n     */\n\n  }, {\n    key: \"discardEditor\",\n    value: function discardEditor(result) {\n      _get(_getPrototypeOf(AutocompleteEditor.prototype), \"discardEditor\", this).call(this, result);\n\n      this.hot.view.render();\n    }\n    /**\n     * Prepares choices list based on applied argument.\n     *\n     * @private\n     * @param {string} query The query.\n     */\n\n  }, {\n    key: \"queryChoices\",\n    value: function queryChoices(query) {\n      var _this4 = this;\n\n      var source = this.cellProperties.source;\n      this.query = query;\n\n      if (typeof source === 'function') {\n        source.call(this.cellProperties, query, function (choices) {\n          _this4.rawChoices = choices;\n\n          _this4.updateChoicesList(_this4.stripValuesIfNeeded(choices));\n        });\n      } else if (Array.isArray(source)) {\n        this.rawChoices = source;\n        this.updateChoicesList(this.stripValuesIfNeeded(source));\n      } else {\n        this.updateChoicesList([]);\n      }\n    }\n    /**\n     * Updates list of the possible completions to choose.\n     *\n     * @private\n     * @param {Array} choicesList The choices list to process.\n     */\n\n  }, {\n    key: \"updateChoicesList\",\n    value: function updateChoicesList(choicesList) {\n      var pos = getCaretPosition(this.TEXTAREA);\n      var endPos = getSelectionEndPosition(this.TEXTAREA);\n      var sortByRelevanceSetting = this.cellProperties.sortByRelevance;\n      var filterSetting = this.cellProperties.filter;\n      var orderByRelevance = null;\n      var highlightIndex = null;\n      var choices = choicesList;\n\n      if (sortByRelevanceSetting) {\n        orderByRelevance = this.sortByRelevance(this.stripValueIfNeeded(this.getValue()), choices, this.cellProperties.filteringCaseSensitive);\n      }\n\n      var orderByRelevanceLength = Array.isArray(orderByRelevance) ? orderByRelevance.length : 0;\n\n      if (filterSetting === false) {\n        if (orderByRelevanceLength) {\n          highlightIndex = orderByRelevance[0];\n        }\n      } else {\n        var sorted = [];\n\n        for (var i = 0, choicesCount = choices.length; i < choicesCount; i++) {\n          if (sortByRelevanceSetting && orderByRelevanceLength <= i) {\n            break;\n          }\n\n          if (orderByRelevanceLength) {\n            sorted.push(choices[orderByRelevance[i]]);\n          } else {\n            sorted.push(choices[i]);\n          }\n        }\n\n        highlightIndex = 0;\n        choices = sorted;\n      }\n\n      this.strippedChoices = choices;\n      this.htEditor.loadData(pivot([choices]));\n      this.updateDropdownHeight();\n      this.flipDropdownIfNeeded();\n\n      if (this.cellProperties.strict === true) {\n        this.highlightBestMatchingChoice(highlightIndex);\n      }\n\n      this.hot.listen();\n      setCaretPosition(this.TEXTAREA, pos, pos === endPos ? void 0 : endPos);\n    }\n    /**\n     * Checks where is enough place to open editor.\n     *\n     * @private\n     * @returns {boolean}\n     */\n\n  }, {\n    key: \"flipDropdownIfNeeded\",\n    value: function flipDropdownIfNeeded() {\n      var textareaOffset = offset(this.TEXTAREA);\n      var textareaHeight = outerHeight(this.TEXTAREA);\n      var dropdownHeight = this.getDropdownHeight();\n      var trimmingContainer = getTrimmingContainer(this.hot.view.wt.wtTable.TABLE);\n      var trimmingContainerScrollTop = trimmingContainer.scrollTop;\n      var headersHeight = outerHeight(this.hot.view.wt.wtTable.THEAD);\n      var containerOffset = {\n        row: 0,\n        col: 0\n      };\n\n      if (trimmingContainer !== this.hot.rootWindow) {\n        containerOffset = offset(trimmingContainer);\n      }\n\n      var spaceAbove = textareaOffset.top - containerOffset.top - headersHeight + trimmingContainerScrollTop;\n      var spaceBelow = trimmingContainer.scrollHeight - spaceAbove - headersHeight - textareaHeight;\n      var flipNeeded = dropdownHeight > spaceBelow && spaceAbove > spaceBelow;\n\n      if (flipNeeded) {\n        this.flipDropdown(dropdownHeight);\n      } else {\n        this.unflipDropdown();\n      }\n\n      this.limitDropdownIfNeeded(flipNeeded ? spaceAbove : spaceBelow, dropdownHeight);\n      return flipNeeded;\n    }\n    /**\n     * Checks if the internal table should generate scrollbar or could be rendered without it.\n     *\n     * @private\n     * @param {number} spaceAvailable The free space as height definded in px available for dropdown list.\n     * @param {number} dropdownHeight The dropdown height.\n     */\n\n  }, {\n    key: \"limitDropdownIfNeeded\",\n    value: function limitDropdownIfNeeded(spaceAvailable, dropdownHeight) {\n      if (dropdownHeight > spaceAvailable) {\n        var tempHeight = 0;\n        var i = 0;\n        var lastRowHeight = 0;\n        var height = null;\n\n        do {\n          lastRowHeight = this.htEditor.getRowHeight(i) || this.htEditor.view.wt.wtSettings.settings.defaultRowHeight;\n          tempHeight += lastRowHeight;\n          i += 1;\n        } while (tempHeight < spaceAvailable);\n\n        height = tempHeight - lastRowHeight;\n\n        if (this.htEditor.flipped) {\n          this.htEditor.rootElement.style.top = \"\".concat(parseInt(this.htEditor.rootElement.style.top, 10) + dropdownHeight - height, \"px\"); // eslint-disable-line max-len\n        }\n\n        this.setDropdownHeight(tempHeight - lastRowHeight);\n      }\n    }\n    /**\n     * Configures editor to open it at the top.\n     *\n     * @private\n     * @param {number} dropdownHeight The dropdown height.\n     */\n\n  }, {\n    key: \"flipDropdown\",\n    value: function flipDropdown(dropdownHeight) {\n      var dropdownStyle = this.htEditor.rootElement.style;\n      dropdownStyle.position = 'absolute';\n      dropdownStyle.top = \"\".concat(-dropdownHeight, \"px\");\n      this.htEditor.flipped = true;\n    }\n    /**\n     * Configures editor to open it at the bottom.\n     *\n     * @private\n     */\n\n  }, {\n    key: \"unflipDropdown\",\n    value: function unflipDropdown() {\n      var dropdownStyle = this.htEditor.rootElement.style;\n\n      if (dropdownStyle.position === 'absolute') {\n        dropdownStyle.position = '';\n        dropdownStyle.top = '';\n      }\n\n      this.htEditor.flipped = void 0;\n    }\n    /**\n     * Updates width and height of the internal Handsontable's instance.\n     *\n     * @private\n     */\n\n  }, {\n    key: \"updateDropdownHeight\",\n    value: function updateDropdownHeight() {\n      var currentDropdownWidth = this.htEditor.getColWidth(0) + getScrollbarWidth(this.hot.rootDocument) + 2;\n      var trimDropdown = this.cellProperties.trimDropdown;\n      this.htEditor.updateSettings({\n        height: this.getDropdownHeight(),\n        width: trimDropdown ? void 0 : currentDropdownWidth\n      });\n      this.htEditor.view.wt.wtTable.alignOverlaysWithTrimmingContainer();\n    }\n    /**\n     * Sets new height of the internal Handsontable's instance.\n     *\n     * @private\n     * @param {number} height The new dropdown height.\n     */\n\n  }, {\n    key: \"setDropdownHeight\",\n    value: function setDropdownHeight(height) {\n      this.htEditor.updateSettings({\n        height: height\n      });\n    }\n    /**\n     * Creates new selection on specified row index, or deselects selected cells.\n     *\n     * @private\n     * @param {number|undefined} index The visual row index.\n     */\n\n  }, {\n    key: \"highlightBestMatchingChoice\",\n    value: function highlightBestMatchingChoice(index) {\n      if (typeof index === 'number') {\n        this.htEditor.selectCell(index, 0, void 0, void 0, void 0, false);\n      } else {\n        this.htEditor.deselectCell();\n      }\n    }\n    /**\n     * Calculates and return the internal Handsontable's height.\n     *\n     * @private\n     * @returns {number}\n     */\n\n  }, {\n    key: \"getDropdownHeight\",\n    value: function getDropdownHeight() {\n      var firstRowHeight = this.htEditor.getInstance().getRowHeight(0) || 23;\n      var visibleRows = this.cellProperties.visibleRows;\n      return this.strippedChoices.length >= visibleRows ? visibleRows * firstRowHeight : this.strippedChoices.length * firstRowHeight + 8; // eslint-disable-line max-len\n    }\n    /**\n     * Sanitizes value from potential dangerous tags.\n     *\n     * @private\n     * @param {string} value The value to sanitize.\n     * @returns {string}\n     */\n\n  }, {\n    key: \"stripValueIfNeeded\",\n    value: function stripValueIfNeeded(value) {\n      return this.stripValuesIfNeeded([value])[0];\n    }\n    /**\n     * Sanitizes an array of the values from potential dangerous tags.\n     *\n     * @private\n     * @param {string[]} values The value to sanitize.\n     * @returns {string[]}\n     */\n\n  }, {\n    key: \"stripValuesIfNeeded\",\n    value: function stripValuesIfNeeded(values) {\n      var allowHtml = this.cellProperties.allowHtml;\n      var stringifiedValues = arrayMap(values, function (value) {\n        return stringify(value);\n      });\n      var strippedValues = arrayMap(stringifiedValues, function (value) {\n        return allowHtml ? value : stripTags(value);\n      });\n      return strippedValues;\n    }\n    /**\n     * Captures use of arrow down and up to control their behaviour.\n     *\n     * @private\n     * @param {number} keyCode The keyboard keycode.\n     * @returns {boolean}\n     */\n\n  }, {\n    key: \"allowKeyEventPropagation\",\n    value: function allowKeyEventPropagation(keyCode) {\n      var selectedRange = this.htEditor.getSelectedRangeLast();\n      var selected = {\n        row: selectedRange ? selectedRange.from.row : -1\n      };\n      var allowed = false;\n\n      if (keyCode === KEY_CODES.ARROW_DOWN && selected.row > 0 && selected.row < this.htEditor.countRows() - 1) {\n        allowed = true;\n      }\n\n      if (keyCode === KEY_CODES.ARROW_UP && selected.row > -1) {\n        allowed = true;\n      }\n\n      return allowed;\n    }\n    /**\n     * OnBeforeKeyDown callback.\n     *\n     * @private\n     * @param {KeyboardEvent} event The keyboard event object.\n     */\n\n  }, {\n    key: \"onBeforeKeyDown\",\n    value: function onBeforeKeyDown(event) {\n      var _this5 = this;\n\n      var priv = privatePool.get(this);\n      priv.skipOne = false;\n\n      if (isPrintableChar(event.keyCode) || event.keyCode === KEY_CODES.BACKSPACE || event.keyCode === KEY_CODES.DELETE || event.keyCode === KEY_CODES.INSERT) {\n        // for Windows 10 + FF86 there is need to add delay to make sure that the value taken from\n        // the textarea is the freshest value. Otherwise the list of choices does not update correctly (see #7570).\n        // On the more modern version of the FF (~ >=91) it seems that the issue is not present or it is\n        // more difficult to induce.\n        var timeOffset = 10; // on ctl+c / cmd+c don't update suggestion list\n\n        if (event.keyCode === KEY_CODES.C && (event.ctrlKey || event.metaKey)) {\n          return;\n        }\n\n        if (!this.isOpened()) {\n          timeOffset += 10;\n        }\n\n        if (this.htEditor) {\n          this.hot._registerTimeout(function () {\n            _this5.queryChoices(_this5.TEXTAREA.value);\n\n            priv.skipOne = true;\n          }, timeOffset);\n        }\n      }\n\n      _get(_getPrototypeOf(AutocompleteEditor.prototype), \"onBeforeKeyDown\", this).call(this, event);\n    }\n    /**\n     * Filters and sorts by relevance.\n     *\n     * @param {*} value The selected value.\n     * @param {string[]} choices The list of available choices.\n     * @param {boolean} caseSensitive Indicates if it's sorted by case.\n     * @returns {number[]} Array of indexes in original choices array.\n     */\n\n  }], [{\n    key: \"EDITOR_TYPE\",\n    get: function get() {\n      return EDITOR_TYPE;\n    }\n  }]);\n\n  return AutocompleteEditor;\n}(HandsontableEditor);","map":{"version":3,"sources":["/Users/shehrozkapoor/Desktop/FIRST_CARE/firstcare-frontend/node_modules/handsontable/editors/autocompleteEditor/autocompleteEditor.mjs"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","protoProps","staticProps","_get","Reflect","get","property","receiver","base","_superPropBase","desc","getOwnPropertyDescriptor","call","arguments","value","apply","object","hasOwnProperty","_getPrototypeOf","_inherits","subClass","superClass","create","_setPrototypeOf","o","p","setPrototypeOf","__proto__","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","result","NewTarget","construct","_possibleConstructorReturn","self","_assertThisInitialized","ReferenceError","sham","Proxy","Boolean","valueOf","e","getPrototypeOf","_defineProperty","HandsontableEditor","arrayMap","pivot","addClass","getCaretPosition","getScrollbarWidth","getSelectionEndPosition","getTrimmingContainer","offset","outerHeight","outerWidth","setCaretPosition","isDefined","stringify","stripTags","KEY_CODES","isPrintableChar","textRenderer","privatePool","WeakMap","EDITOR_TYPE","AutocompleteEditor","_HandsontableEditor","_super","_this","choices","caseSensitive","choicesRelevance","valueLength","choicesCount","charsLeft","currentItem","valueIndex","push","indexOf","locale","cellProperties","toLocaleLowerCase","baseIndex","index","sort","a","b","query","strippedChoices","rawChoices","set","skipOne","isMacOS","hot","rootWindow","navigator","platform","getValue","_this2","selectedValue","find","strippedValue","stripValueIfNeeded","TEXTAREA","createElements","htContainer","open","_this3","priv","choicesListHot","htEditor","getInstance","trimDropdown","showEditableElement","focus","scrollbarWidth","updateSettings","colWidths","width","renderer","TD","row","col","prop","_this3$cellProperties","filteringCaseSensitive","allowHtml","cellValue","indexOfMatch","match","substr","replace","concat","innerHTML","autoColumnSize","_registerTimeout","queryChoices","close","removeHooksByKey","discardEditor","view","render","_this4","source","updateChoicesList","stripValuesIfNeeded","Array","isArray","choicesList","pos","endPos","sortByRelevanceSetting","sortByRelevance","filterSetting","filter","orderByRelevance","highlightIndex","orderByRelevanceLength","sorted","loadData","updateDropdownHeight","flipDropdownIfNeeded","strict","highlightBestMatchingChoice","listen","textareaOffset","textareaHeight","dropdownHeight","getDropdownHeight","trimmingContainer","wt","wtTable","TABLE","trimmingContainerScrollTop","scrollTop","headersHeight","THEAD","containerOffset","spaceAbove","top","spaceBelow","scrollHeight","flipNeeded","flipDropdown","unflipDropdown","limitDropdownIfNeeded","spaceAvailable","tempHeight","lastRowHeight","height","getRowHeight","wtSettings","settings","defaultRowHeight","flipped","rootElement","style","parseInt","setDropdownHeight","dropdownStyle","position","currentDropdownWidth","getColWidth","rootDocument","alignOverlaysWithTrimmingContainer","selectCell","deselectCell","firstRowHeight","visibleRows","values","stringifiedValues","strippedValues","allowKeyEventPropagation","keyCode","selectedRange","getSelectedRangeLast","selected","from","allowed","ARROW_DOWN","countRows","ARROW_UP","onBeforeKeyDown","event","_this5","BACKSPACE","DELETE","INSERT","timeOffset","C","ctrlKey","metaKey","isOpened"],"mappings":"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","sourcesContent":["function _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _get() { if (typeof Reflect !== \"undefined\" && Reflect.get) { _get = Reflect.get; } else { _get = function _get(target, property, receiver) { var base = _superPropBase(target, property); if (!base) return; var desc = Object.getOwnPropertyDescriptor(base, property); if (desc.get) { return desc.get.call(arguments.length < 3 ? target : receiver); } return desc.value; }; } return _get.apply(this, arguments); }\n\nfunction _superPropBase(object, property) { while (!Object.prototype.hasOwnProperty.call(object, property)) { object = _getPrototypeOf(object); if (object === null) break; } return object; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport \"core-js/modules/es.array.iterator.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/es.weak-map.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/es.array.index-of.js\";\nimport \"core-js/modules/es.array.sort.js\";\nimport \"core-js/modules/es.array.find.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.string.replace.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.object.set-prototype-of.js\";\nimport \"core-js/modules/es.object.get-prototype-of.js\";\nimport \"core-js/modules/es.reflect.construct.js\";\nimport \"core-js/modules/es.reflect.get.js\";\nimport \"core-js/modules/es.object.get-own-property-descriptor.js\";\nimport \"core-js/modules/es.symbol.js\";\nimport \"core-js/modules/es.symbol.description.js\";\nimport \"core-js/modules/es.symbol.iterator.js\";\nimport { HandsontableEditor } from \"../handsontableEditor/index.mjs\";\nimport { arrayMap, pivot } from \"../../helpers/array.mjs\";\nimport { addClass, getCaretPosition, getScrollbarWidth, getSelectionEndPosition, getTrimmingContainer, offset, outerHeight, outerWidth, setCaretPosition } from \"../../helpers/dom/element.mjs\";\nimport { isDefined, stringify } from \"../../helpers/mixed.mjs\";\nimport { stripTags } from \"../../helpers/string.mjs\";\nimport { KEY_CODES, isPrintableChar } from \"../../helpers/unicode.mjs\";\nimport { textRenderer } from \"../../renderers/textRenderer/index.mjs\";\nvar privatePool = new WeakMap();\nexport var EDITOR_TYPE = 'autocomplete';\n/**\n * @private\n * @class AutocompleteEditor\n */\n\nexport var AutocompleteEditor = /*#__PURE__*/function (_HandsontableEditor) {\n  _inherits(AutocompleteEditor, _HandsontableEditor);\n\n  var _super = _createSuper(AutocompleteEditor);\n\n  function AutocompleteEditor(instance) {\n    var _this;\n\n    _classCallCheck(this, AutocompleteEditor);\n\n    _this = _super.call(this, instance);\n    /**\n     * Query string to turn available values over.\n     *\n     * @type {string}\n     */\n\n    _defineProperty(_assertThisInitialized(_this), \"sortByRelevance\", function (value, choices, caseSensitive) {\n      var choicesRelevance = [];\n      var result = [];\n      var valueLength = value.length;\n      var choicesCount = choices.length;\n      var charsLeft;\n      var currentItem;\n      var i;\n      var valueIndex;\n\n      if (valueLength === 0) {\n        for (i = 0; i < choicesCount; i++) {\n          result.push(i);\n        }\n\n        return result;\n      }\n\n      for (i = 0; i < choicesCount; i++) {\n        currentItem = stripTags(stringify(choices[i]));\n\n        if (caseSensitive) {\n          valueIndex = currentItem.indexOf(value);\n        } else {\n          var locale = this.cellProperties.locale;\n          valueIndex = currentItem.toLocaleLowerCase(locale).indexOf(value.toLocaleLowerCase(locale));\n        }\n\n        if (valueIndex !== -1) {\n          charsLeft = currentItem.length - valueIndex - valueLength;\n          choicesRelevance.push({\n            baseIndex: i,\n            index: valueIndex,\n            charsLeft: charsLeft,\n            value: currentItem\n          });\n        }\n      }\n\n      choicesRelevance.sort(function (a, b) {\n        if (b.index === -1) {\n          return -1;\n        }\n\n        if (a.index === -1) {\n          return 1;\n        }\n\n        if (a.index < b.index) {\n          return -1;\n        } else if (b.index < a.index) {\n          return 1;\n        } else if (a.index === b.index) {\n          if (a.charsLeft < b.charsLeft) {\n            return -1;\n          } else if (a.charsLeft > b.charsLeft) {\n            return 1;\n          }\n        }\n\n        return 0;\n      });\n\n      for (i = 0, choicesCount = choicesRelevance.length; i < choicesCount; i++) {\n        result.push(choicesRelevance[i].baseIndex);\n      }\n\n      return result;\n    });\n\n    _this.query = null;\n    /**\n     * Contains stripped choices.\n     *\n     * @type {string[]}\n     */\n\n    _this.strippedChoices = [];\n    /**\n     * Contains raw choices.\n     *\n     * @type {Array}\n     */\n\n    _this.rawChoices = [];\n    privatePool.set(_assertThisInitialized(_this), {\n      skipOne: false,\n      isMacOS: _this.hot.rootWindow.navigator.platform.indexOf('Mac') > -1\n    });\n    return _this;\n  }\n  /**\n   * Gets current value from editable element.\n   *\n   * @returns {string}\n   */\n\n\n  _createClass(AutocompleteEditor, [{\n    key: \"getValue\",\n    value: function getValue() {\n      var _this2 = this;\n\n      var selectedValue = this.rawChoices.find(function (value) {\n        var strippedValue = _this2.stripValueIfNeeded(value);\n\n        return strippedValue === _this2.TEXTAREA.value;\n      });\n\n      if (isDefined(selectedValue)) {\n        return selectedValue;\n      }\n\n      return this.TEXTAREA.value;\n    }\n    /**\n     * Creates an editor's elements and adds necessary CSS classnames.\n     */\n\n  }, {\n    key: \"createElements\",\n    value: function createElements() {\n      _get(_getPrototypeOf(AutocompleteEditor.prototype), \"createElements\", this).call(this);\n\n      addClass(this.htContainer, 'autocompleteEditor');\n      addClass(this.htContainer, this.hot.rootWindow.navigator.platform.indexOf('Mac') === -1 ? '' : 'htMacScroll');\n    }\n    /**\n     * Opens the editor and adjust its size and internal Handsontable's instance.\n     */\n\n  }, {\n    key: \"open\",\n    value: function open() {\n      var _this3 = this;\n\n      var priv = privatePool.get(this);\n\n      _get(_getPrototypeOf(AutocompleteEditor.prototype), \"open\", this).call(this);\n\n      var choicesListHot = this.htEditor.getInstance();\n      var trimDropdown = this.cellProperties.trimDropdown === void 0 ? true : this.cellProperties.trimDropdown;\n      this.showEditableElement();\n      this.focus();\n      var scrollbarWidth = getScrollbarWidth();\n\n      if (scrollbarWidth === 0 && priv.isMacOS) {\n        scrollbarWidth += 15; // default scroll bar width if scroll bars are visible only when scrolling\n      }\n\n      choicesListHot.updateSettings({\n        colWidths: trimDropdown ? [outerWidth(this.TEXTAREA) - 2] : void 0,\n        width: trimDropdown ? outerWidth(this.TEXTAREA) + scrollbarWidth : void 0,\n        renderer: function renderer(instance, TD, row, col, prop, value, cellProperties) {\n          textRenderer(instance, TD, row, col, prop, value, cellProperties);\n          var _this3$cellProperties = _this3.cellProperties,\n              filteringCaseSensitive = _this3$cellProperties.filteringCaseSensitive,\n              allowHtml = _this3$cellProperties.allowHtml,\n              locale = _this3$cellProperties.locale;\n          var query = _this3.query;\n          var cellValue = stringify(value);\n          var indexOfMatch;\n          var match;\n\n          if (cellValue && !allowHtml) {\n            indexOfMatch = filteringCaseSensitive === true ? cellValue.indexOf(query) : cellValue.toLocaleLowerCase(locale).indexOf(query.toLocaleLowerCase(locale));\n\n            if (indexOfMatch !== -1) {\n              match = cellValue.substr(indexOfMatch, query.length);\n              cellValue = cellValue.replace(match, \"<strong>\".concat(match, \"</strong>\"));\n            }\n          }\n\n          TD.innerHTML = cellValue;\n        },\n        autoColumnSize: true\n      });\n\n      if (priv.skipOne) {\n        priv.skipOne = false;\n      }\n\n      this.hot._registerTimeout(function () {\n        _this3.queryChoices(_this3.TEXTAREA.value);\n      });\n    }\n    /**\n     * Closes the editor.\n     */\n\n  }, {\n    key: \"close\",\n    value: function close() {\n      this.removeHooksByKey('beforeKeyDown');\n\n      _get(_getPrototypeOf(AutocompleteEditor.prototype), \"close\", this).call(this);\n    }\n    /**\n     * Verifies result of validation or closes editor if user's cancelled changes.\n     *\n     * @param {boolean|undefined} result If `false` and the cell using allowInvalid option,\n     *                                   then an editor won't be closed until validation is passed.\n     */\n\n  }, {\n    key: \"discardEditor\",\n    value: function discardEditor(result) {\n      _get(_getPrototypeOf(AutocompleteEditor.prototype), \"discardEditor\", this).call(this, result);\n\n      this.hot.view.render();\n    }\n    /**\n     * Prepares choices list based on applied argument.\n     *\n     * @private\n     * @param {string} query The query.\n     */\n\n  }, {\n    key: \"queryChoices\",\n    value: function queryChoices(query) {\n      var _this4 = this;\n\n      var source = this.cellProperties.source;\n      this.query = query;\n\n      if (typeof source === 'function') {\n        source.call(this.cellProperties, query, function (choices) {\n          _this4.rawChoices = choices;\n\n          _this4.updateChoicesList(_this4.stripValuesIfNeeded(choices));\n        });\n      } else if (Array.isArray(source)) {\n        this.rawChoices = source;\n        this.updateChoicesList(this.stripValuesIfNeeded(source));\n      } else {\n        this.updateChoicesList([]);\n      }\n    }\n    /**\n     * Updates list of the possible completions to choose.\n     *\n     * @private\n     * @param {Array} choicesList The choices list to process.\n     */\n\n  }, {\n    key: \"updateChoicesList\",\n    value: function updateChoicesList(choicesList) {\n      var pos = getCaretPosition(this.TEXTAREA);\n      var endPos = getSelectionEndPosition(this.TEXTAREA);\n      var sortByRelevanceSetting = this.cellProperties.sortByRelevance;\n      var filterSetting = this.cellProperties.filter;\n      var orderByRelevance = null;\n      var highlightIndex = null;\n      var choices = choicesList;\n\n      if (sortByRelevanceSetting) {\n        orderByRelevance = this.sortByRelevance(this.stripValueIfNeeded(this.getValue()), choices, this.cellProperties.filteringCaseSensitive);\n      }\n\n      var orderByRelevanceLength = Array.isArray(orderByRelevance) ? orderByRelevance.length : 0;\n\n      if (filterSetting === false) {\n        if (orderByRelevanceLength) {\n          highlightIndex = orderByRelevance[0];\n        }\n      } else {\n        var sorted = [];\n\n        for (var i = 0, choicesCount = choices.length; i < choicesCount; i++) {\n          if (sortByRelevanceSetting && orderByRelevanceLength <= i) {\n            break;\n          }\n\n          if (orderByRelevanceLength) {\n            sorted.push(choices[orderByRelevance[i]]);\n          } else {\n            sorted.push(choices[i]);\n          }\n        }\n\n        highlightIndex = 0;\n        choices = sorted;\n      }\n\n      this.strippedChoices = choices;\n      this.htEditor.loadData(pivot([choices]));\n      this.updateDropdownHeight();\n      this.flipDropdownIfNeeded();\n\n      if (this.cellProperties.strict === true) {\n        this.highlightBestMatchingChoice(highlightIndex);\n      }\n\n      this.hot.listen();\n      setCaretPosition(this.TEXTAREA, pos, pos === endPos ? void 0 : endPos);\n    }\n    /**\n     * Checks where is enough place to open editor.\n     *\n     * @private\n     * @returns {boolean}\n     */\n\n  }, {\n    key: \"flipDropdownIfNeeded\",\n    value: function flipDropdownIfNeeded() {\n      var textareaOffset = offset(this.TEXTAREA);\n      var textareaHeight = outerHeight(this.TEXTAREA);\n      var dropdownHeight = this.getDropdownHeight();\n      var trimmingContainer = getTrimmingContainer(this.hot.view.wt.wtTable.TABLE);\n      var trimmingContainerScrollTop = trimmingContainer.scrollTop;\n      var headersHeight = outerHeight(this.hot.view.wt.wtTable.THEAD);\n      var containerOffset = {\n        row: 0,\n        col: 0\n      };\n\n      if (trimmingContainer !== this.hot.rootWindow) {\n        containerOffset = offset(trimmingContainer);\n      }\n\n      var spaceAbove = textareaOffset.top - containerOffset.top - headersHeight + trimmingContainerScrollTop;\n      var spaceBelow = trimmingContainer.scrollHeight - spaceAbove - headersHeight - textareaHeight;\n      var flipNeeded = dropdownHeight > spaceBelow && spaceAbove > spaceBelow;\n\n      if (flipNeeded) {\n        this.flipDropdown(dropdownHeight);\n      } else {\n        this.unflipDropdown();\n      }\n\n      this.limitDropdownIfNeeded(flipNeeded ? spaceAbove : spaceBelow, dropdownHeight);\n      return flipNeeded;\n    }\n    /**\n     * Checks if the internal table should generate scrollbar or could be rendered without it.\n     *\n     * @private\n     * @param {number} spaceAvailable The free space as height definded in px available for dropdown list.\n     * @param {number} dropdownHeight The dropdown height.\n     */\n\n  }, {\n    key: \"limitDropdownIfNeeded\",\n    value: function limitDropdownIfNeeded(spaceAvailable, dropdownHeight) {\n      if (dropdownHeight > spaceAvailable) {\n        var tempHeight = 0;\n        var i = 0;\n        var lastRowHeight = 0;\n        var height = null;\n\n        do {\n          lastRowHeight = this.htEditor.getRowHeight(i) || this.htEditor.view.wt.wtSettings.settings.defaultRowHeight;\n          tempHeight += lastRowHeight;\n          i += 1;\n        } while (tempHeight < spaceAvailable);\n\n        height = tempHeight - lastRowHeight;\n\n        if (this.htEditor.flipped) {\n          this.htEditor.rootElement.style.top = \"\".concat(parseInt(this.htEditor.rootElement.style.top, 10) + dropdownHeight - height, \"px\"); // eslint-disable-line max-len\n        }\n\n        this.setDropdownHeight(tempHeight - lastRowHeight);\n      }\n    }\n    /**\n     * Configures editor to open it at the top.\n     *\n     * @private\n     * @param {number} dropdownHeight The dropdown height.\n     */\n\n  }, {\n    key: \"flipDropdown\",\n    value: function flipDropdown(dropdownHeight) {\n      var dropdownStyle = this.htEditor.rootElement.style;\n      dropdownStyle.position = 'absolute';\n      dropdownStyle.top = \"\".concat(-dropdownHeight, \"px\");\n      this.htEditor.flipped = true;\n    }\n    /**\n     * Configures editor to open it at the bottom.\n     *\n     * @private\n     */\n\n  }, {\n    key: \"unflipDropdown\",\n    value: function unflipDropdown() {\n      var dropdownStyle = this.htEditor.rootElement.style;\n\n      if (dropdownStyle.position === 'absolute') {\n        dropdownStyle.position = '';\n        dropdownStyle.top = '';\n      }\n\n      this.htEditor.flipped = void 0;\n    }\n    /**\n     * Updates width and height of the internal Handsontable's instance.\n     *\n     * @private\n     */\n\n  }, {\n    key: \"updateDropdownHeight\",\n    value: function updateDropdownHeight() {\n      var currentDropdownWidth = this.htEditor.getColWidth(0) + getScrollbarWidth(this.hot.rootDocument) + 2;\n      var trimDropdown = this.cellProperties.trimDropdown;\n      this.htEditor.updateSettings({\n        height: this.getDropdownHeight(),\n        width: trimDropdown ? void 0 : currentDropdownWidth\n      });\n      this.htEditor.view.wt.wtTable.alignOverlaysWithTrimmingContainer();\n    }\n    /**\n     * Sets new height of the internal Handsontable's instance.\n     *\n     * @private\n     * @param {number} height The new dropdown height.\n     */\n\n  }, {\n    key: \"setDropdownHeight\",\n    value: function setDropdownHeight(height) {\n      this.htEditor.updateSettings({\n        height: height\n      });\n    }\n    /**\n     * Creates new selection on specified row index, or deselects selected cells.\n     *\n     * @private\n     * @param {number|undefined} index The visual row index.\n     */\n\n  }, {\n    key: \"highlightBestMatchingChoice\",\n    value: function highlightBestMatchingChoice(index) {\n      if (typeof index === 'number') {\n        this.htEditor.selectCell(index, 0, void 0, void 0, void 0, false);\n      } else {\n        this.htEditor.deselectCell();\n      }\n    }\n    /**\n     * Calculates and return the internal Handsontable's height.\n     *\n     * @private\n     * @returns {number}\n     */\n\n  }, {\n    key: \"getDropdownHeight\",\n    value: function getDropdownHeight() {\n      var firstRowHeight = this.htEditor.getInstance().getRowHeight(0) || 23;\n      var visibleRows = this.cellProperties.visibleRows;\n      return this.strippedChoices.length >= visibleRows ? visibleRows * firstRowHeight : this.strippedChoices.length * firstRowHeight + 8; // eslint-disable-line max-len\n    }\n    /**\n     * Sanitizes value from potential dangerous tags.\n     *\n     * @private\n     * @param {string} value The value to sanitize.\n     * @returns {string}\n     */\n\n  }, {\n    key: \"stripValueIfNeeded\",\n    value: function stripValueIfNeeded(value) {\n      return this.stripValuesIfNeeded([value])[0];\n    }\n    /**\n     * Sanitizes an array of the values from potential dangerous tags.\n     *\n     * @private\n     * @param {string[]} values The value to sanitize.\n     * @returns {string[]}\n     */\n\n  }, {\n    key: \"stripValuesIfNeeded\",\n    value: function stripValuesIfNeeded(values) {\n      var allowHtml = this.cellProperties.allowHtml;\n      var stringifiedValues = arrayMap(values, function (value) {\n        return stringify(value);\n      });\n      var strippedValues = arrayMap(stringifiedValues, function (value) {\n        return allowHtml ? value : stripTags(value);\n      });\n      return strippedValues;\n    }\n    /**\n     * Captures use of arrow down and up to control their behaviour.\n     *\n     * @private\n     * @param {number} keyCode The keyboard keycode.\n     * @returns {boolean}\n     */\n\n  }, {\n    key: \"allowKeyEventPropagation\",\n    value: function allowKeyEventPropagation(keyCode) {\n      var selectedRange = this.htEditor.getSelectedRangeLast();\n      var selected = {\n        row: selectedRange ? selectedRange.from.row : -1\n      };\n      var allowed = false;\n\n      if (keyCode === KEY_CODES.ARROW_DOWN && selected.row > 0 && selected.row < this.htEditor.countRows() - 1) {\n        allowed = true;\n      }\n\n      if (keyCode === KEY_CODES.ARROW_UP && selected.row > -1) {\n        allowed = true;\n      }\n\n      return allowed;\n    }\n    /**\n     * OnBeforeKeyDown callback.\n     *\n     * @private\n     * @param {KeyboardEvent} event The keyboard event object.\n     */\n\n  }, {\n    key: \"onBeforeKeyDown\",\n    value: function onBeforeKeyDown(event) {\n      var _this5 = this;\n\n      var priv = privatePool.get(this);\n      priv.skipOne = false;\n\n      if (isPrintableChar(event.keyCode) || event.keyCode === KEY_CODES.BACKSPACE || event.keyCode === KEY_CODES.DELETE || event.keyCode === KEY_CODES.INSERT) {\n        // for Windows 10 + FF86 there is need to add delay to make sure that the value taken from\n        // the textarea is the freshest value. Otherwise the list of choices does not update correctly (see #7570).\n        // On the more modern version of the FF (~ >=91) it seems that the issue is not present or it is\n        // more difficult to induce.\n        var timeOffset = 10; // on ctl+c / cmd+c don't update suggestion list\n\n        if (event.keyCode === KEY_CODES.C && (event.ctrlKey || event.metaKey)) {\n          return;\n        }\n\n        if (!this.isOpened()) {\n          timeOffset += 10;\n        }\n\n        if (this.htEditor) {\n          this.hot._registerTimeout(function () {\n            _this5.queryChoices(_this5.TEXTAREA.value);\n\n            priv.skipOne = true;\n          }, timeOffset);\n        }\n      }\n\n      _get(_getPrototypeOf(AutocompleteEditor.prototype), \"onBeforeKeyDown\", this).call(this, event);\n    }\n    /**\n     * Filters and sorts by relevance.\n     *\n     * @param {*} value The selected value.\n     * @param {string[]} choices The list of available choices.\n     * @param {boolean} caseSensitive Indicates if it's sorted by case.\n     * @returns {number[]} Array of indexes in original choices array.\n     */\n\n  }], [{\n    key: \"EDITOR_TYPE\",\n    get: function get() {\n      return EDITOR_TYPE;\n    }\n  }]);\n\n  return AutocompleteEditor;\n}(HandsontableEditor);"]},"metadata":{},"sourceType":"module"}