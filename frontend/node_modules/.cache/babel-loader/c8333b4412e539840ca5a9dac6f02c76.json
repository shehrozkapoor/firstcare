{"ast":null,"code":"// Utilities\nimport { computed, inject, provide, ref, watch } from 'vue';\nimport { useProxiedModel } from \"./proxiedModel.mjs\";\nimport { consoleWarn, propsFactory } from \"../util/index.mjs\"; // Types\n\nexport const FormKey = Symbol.for('vuetify:form');\nexport const makeFormProps = propsFactory({\n  disabled: Boolean,\n  fastFail: Boolean,\n  lazyValidation: Boolean,\n  readonly: Boolean,\n  modelValue: {\n    type: Boolean,\n    default: null\n  }\n});\nexport function createForm(props) {\n  const model = useProxiedModel(props, 'modelValue');\n  const isDisabled = computed(() => props.disabled);\n  const isReadonly = computed(() => props.readonly);\n  const isValidating = ref(false);\n  const items = ref([]);\n  const errorMessages = ref([]);\n\n  async function validate() {\n    const results = [];\n    let valid = true;\n    errorMessages.value = [];\n    isValidating.value = true;\n\n    for (const item of items.value) {\n      const itemErrorMessages = await item.validate();\n\n      if (itemErrorMessages.length > 0) {\n        valid = false;\n        results.push({\n          id: item.id,\n          errorMessages: itemErrorMessages\n        });\n      }\n\n      if (!valid && props.fastFail) break;\n    }\n\n    errorMessages.value = results;\n    isValidating.value = false;\n    return {\n      valid,\n      errorMessages: errorMessages.value\n    };\n  }\n\n  function reset() {\n    items.value.forEach(item => item.reset());\n    model.value = null;\n  }\n\n  function resetValidation() {\n    items.value.forEach(item => item.resetValidation());\n    errorMessages.value = [];\n    model.value = null;\n  }\n\n  watch(items, () => {\n    let valid = null;\n\n    if (items.value.some(item => item.isValid === false)) {\n      valid = false;\n    } else if (items.value.every(item => item.isValid === true)) {\n      valid = true;\n    }\n\n    model.value = valid;\n  }, {\n    deep: true\n  });\n  provide(FormKey, {\n    register: (id, validate, reset, resetValidation, isValid) => {\n      if (items.value.some(item => item.id === id)) {\n        consoleWarn(`Duplicate input name \"${id}\"`);\n      }\n\n      items.value.push({\n        id,\n        validate,\n        reset,\n        resetValidation,\n        isValid: isValid // TODO: Better way to type this unwrapping?\n\n      });\n    },\n    unregister: id => {\n      items.value = items.value.filter(item => {\n        return item.id !== id;\n      });\n    },\n    isDisabled,\n    isReadonly,\n    isValidating,\n    items\n  });\n  return {\n    errorMessages,\n    isDisabled,\n    isReadonly,\n    isValidating,\n    items,\n    validate,\n    reset,\n    resetValidation\n  };\n}\nexport function useForm() {\n  return inject(FormKey, null);\n}","map":{"version":3,"mappings":"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","names":["computed","inject","provide","ref","watch","useProxiedModel","consoleWarn","propsFactory","FormKey","Symbol","for","makeFormProps","disabled","Boolean","fastFail","lazyValidation","readonly","modelValue","type","default","createForm","props","model","isDisabled","isReadonly","isValidating","items","errorMessages","validate","results","valid","value","item","itemErrorMessages","length","push","id","reset","forEach","resetValidation","some","isValid","every","deep","register","unregister","filter","useForm"],"sources":["../../src/composables/form.ts"],"sourcesContent":["// Utilities\nimport { computed, inject, provide, ref, watch } from 'vue'\nimport { useProxiedModel } from '@/composables/proxiedModel'\nimport { consoleWarn, propsFactory } from '@/util'\n\n// Types\nimport type { ComputedRef, InjectionKey, PropType, Ref } from 'vue'\n\nexport interface FormProvide {\n  register: (\n    id: number | string,\n    validate: () => Promise<string[]>,\n    reset: () => void,\n    resetValidation: () => void,\n    isValid: Ref<boolean | null>,\n  ) => void\n  unregister: (id: number | string) => void\n  items: Ref<FormField[]>\n  isDisabled: ComputedRef<boolean>\n  isReadonly: ComputedRef<boolean>\n  isValidating: Ref<boolean>\n}\n\ninterface FormField {\n  id: number | string\n  validate: () => Promise<string[]>\n  reset: () => void\n  resetValidation: () => void\n  isValid: boolean | null\n}\n\ninterface FormValidationResult {\n  id: number | string\n  errorMessages: string[]\n}\n\nexport interface SubmitEventPromise extends SubmitEvent, Promise<{ valid: boolean, errorMessages: FormValidationResult[] }> {}\n\nexport const FormKey: InjectionKey<FormProvide> = Symbol.for('vuetify:form')\n\nexport interface FormProps {\n  disabled: boolean\n  fastFail: boolean\n  lazyValidation: boolean\n  readonly: boolean\n  modelValue: boolean | null\n  'onUpdate:modelValue': ((val: boolean | null) => void) | undefined\n}\n\nexport const makeFormProps = propsFactory({\n  disabled: Boolean,\n  fastFail: Boolean,\n  lazyValidation: Boolean,\n  readonly: Boolean,\n  modelValue: {\n    type: Boolean as PropType<boolean | null>,\n    default: null,\n  },\n})\n\nexport function createForm (props: FormProps) {\n  const model = useProxiedModel(props, 'modelValue')\n\n  const isDisabled = computed(() => props.disabled)\n  const isReadonly = computed(() => props.readonly)\n  const isValidating = ref(false)\n  const items = ref<FormField[]>([])\n  const errorMessages = ref<FormValidationResult[]>([])\n\n  async function validate () {\n    const results = []\n    let valid = true\n\n    errorMessages.value = []\n    isValidating.value = true\n\n    for (const item of items.value) {\n      const itemErrorMessages = await item.validate()\n\n      if (itemErrorMessages.length > 0) {\n        valid = false\n\n        results.push({\n          id: item.id,\n          errorMessages: itemErrorMessages,\n        })\n      }\n\n      if (!valid && props.fastFail) break\n    }\n\n    errorMessages.value = results\n    isValidating.value = false\n\n    return { valid, errorMessages: errorMessages.value }\n  }\n\n  function reset () {\n    items.value.forEach(item => item.reset())\n    model.value = null\n  }\n\n  function resetValidation () {\n    items.value.forEach(item => item.resetValidation())\n    errorMessages.value = []\n    model.value = null\n  }\n\n  watch(items, () => {\n    let valid = null\n\n    if (items.value.some(item => item.isValid === false)) {\n      valid = false\n    } else if (items.value.every(item => item.isValid === true)) {\n      valid = true\n    }\n\n    model.value = valid\n  }, {\n    deep: true,\n  })\n\n  provide(FormKey, {\n    register: (id, validate, reset, resetValidation, isValid) => {\n      if (items.value.some(item => item.id === id)) {\n        consoleWarn(`Duplicate input name \"${id}\"`)\n      }\n\n      items.value.push({\n        id,\n        validate,\n        reset,\n        resetValidation,\n        isValid: isValid as unknown as boolean | null, // TODO: Better way to type this unwrapping?\n      })\n    },\n    unregister: id => {\n      items.value = items.value.filter(item => {\n        return item.id !== id\n      })\n    },\n    isDisabled,\n    isReadonly,\n    isValidating,\n    items,\n  })\n\n  return {\n    errorMessages,\n    isDisabled,\n    isReadonly,\n    isValidating,\n    items,\n    validate,\n    reset,\n    resetValidation,\n  }\n}\n\nexport function useForm () {\n  return inject(FormKey, null)\n}\n"]},"metadata":{},"sourceType":"module"}